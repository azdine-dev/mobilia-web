<h3>Create New Bus</h3>

<mat-stepper [linear]="isLinear" #stepper>
  <mat-step [stepControl]="busFormStep1">
    <form [formGroup]="busFormStep1">
      <ng-template matStepLabel>Bus Basic Info</ng-template>
      <div class="row mb-4 mt-3">
        <div class="col-md-4">
          <div class="profile-form-group">
            <label>Bus Number<span class="text-danger">*</span></label>
            <input
              type="text"
              class="form-control"
              placeholder="Bus Number"
              formControlName="busNumber"
              required
            />
          </div>
        </div>
        <div class="col-md-4">
          <div class="profile-form-group">
            <label>Name<span class="text-danger">*</span></label>
            <input
              type="text"
              class="form-control"
              placeholder="Bus Name"
              formControlName="name"
            />
          </div>
        </div>
        <!-- <mat-form-field>
          <mat-label>Model</mat-label>
          <input
            matInput
            placeholder="Model"
            formControlName="model"
            required
          />
        </mat-form-field> -->
        <div class="col-md-4">
          <div class="profile-form-group">
            <label>Model<span class="text-danger">*</span></label>
            <input
              type="text"
              class="form-control"
              placeholder="Model"
              formControlName="model"
              required="true"
            />
          </div>
        </div>
      </div>

      <div class="row mb-5">
        <div class="col-md-4">
          <div class="profile-form-group">
            <label>Latitude</label>
            <input
              type="text"
              class="form-control"
              placeholder="Latitude"
              formControlName="latitude"
            />
          </div>
        </div>

        <div class="col-md-4">
          <div class="profile-form-group">
            <label>Lontitude</label>
            <input
              type="text"
              class="form-control"
              placeholder="Longitude"
              formControlName="longitude"
            />
          </div>
        </div>
      </div>
      <div class="profile-submit-btn">
        <button type="submit" class="btn btn-secondary" matStepperNext>
          Next
        </button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="busFormStep2" label="Images + Services">
    <form [formGroup]="busFormStep2">
      <div class="row">
        <div class="col-md-4">
          <h5>Select Bus Services</h5>
          <mat-form-field class="example-chip-input">
            <mat-label>Bus Services</mat-label>
            <mat-chip-grid #chipGrid aria-label="Services selection">
              @for (amenity of amenities; track amenity) {
              <mat-chip-row (removed)="removeAmenity(amenity)">
                {{ amenity }}
                <button matChipRemove [attr.aria-label]="'remove ' + amenity">
                  <mat-icon>cancel</mat-icon>
                </button>
              </mat-chip-row>
              }
            </mat-chip-grid>
            <input
              placeholder="Add New Service..."
              #amenitiesInput
              [matChipInputFor]="chipGrid"
              [formControl]="amenitiesCtrl"
              [matAutocomplete]="auto"
              [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
              (matChipInputTokenEnd)="addAmenity($event)"
              (click)="amenitiesInput.focus()"
            />

            <mat-autocomplete
              #auto="matAutocomplete"
              (optionSelected)="addSelectedAmenity($event)"
            >
              @for (amenity of filteredAmenities | async; track amenity) {
              <mat-option [value]="amenity">{{ amenity }}</mat-option>
              }
            </mat-autocomplete>
          </mat-form-field>
        </div>
        <!-- Bus Images -->
        <div class="col-md-8">
          <h5>Select Images</h5>
          <app-uploader></app-uploader>
        </div>
      </div>
      <div class="profile-submit-btn">
        <button type="submit" class="btn btn-secondary next" matStepperPrevious>
          Back
        </button>
        <button type="submit" class="btn btn-secondary" matStepperNext>
          Next
        </button>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="busFormStep3">
    <form [formGroup]="busFormStep3">
      <ng-template matStepLabel>Additional Info</ng-template>
      <div class="row mb-4 mt-3">
        <div class="col-md-4">
          <div class="profile-form-group">
            <label>Capacity<span class="text-danger">*</span></label>
            <input
              type="number"
              value="1"
              class="form-control"
              placeholder="Bus Number"
              formControlName="capacity"
              required
            />
          </div>
        </div>
        <div class="col-md-8">
          <div class="profile-form-group">
            <label>Description<span class="text-danger">*</span></label>
            <textarea
              class="form-control"
              placeholder="Enter Description"
              formControlName="description"
            ></textarea>
          </div>
        </div>
      </div>

      <div class="profile-submit-btn">
        <button type="submit" class="btn btn-secondary next" matStepperPrevious>
          Back
        </button>
        <button type="submit" class="btn btn-secondary" matStepperNext>
          Next
        </button>
      </div>
    </form>
  </mat-step>

  <mat-step>
    <ng-template matStepLabel>Done</ng-template>

    <p>Please Submit the infos</p>
    <hr />
    <hr />
    <div>
      @if(isSubmitting){
      <mat-progress-bar mode="indeterminate" color="primary"></mat-progress-bar>
      }

      <button type="submit" class="btn btn-secondary next" matStepperPrevious>
        Back
      </button>
      <button
        type="submit"
        class="btn btn-secondary next"
        (click)="stepper.reset()"
      >
        Reset
      </button>
      <button type="submit" class="btn btn-primary" (click)="submit()">
        Submit
      </button>
    </div>
  </mat-step>
</mat-stepper>
